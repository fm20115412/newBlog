## 配置测试覆盖率
**1. 安装依赖**
```
npm i -D jest-junit
```
**2. jest.config.js文件添加配置属性**
```
collectCoverage: true,
collectCoverageFrom: ["lib/**/*.{ts,tsx}", "!**/node_modules/**"],
collectDirectory: "coverage",
coverageReporters: ["text", "lcov"],
reporters: ["default", "jest-junit"],
```
**3. 为package.json文件ci命令**
```
"ci": "JEST_JUNIT_OUTPUT_NAME=./test-results/jest/results.xml jest --config jest.config.js -u "
```
**4. 生成测试信息**
执行`npm run ci`之后，
a. 会在根目录下生成`covergae`目录，里面的`coverage/lcov-report/index.html`的文件给出了测试覆盖率，可在浏览器中打开：
![](./images/16.png)
b. 会在`test-results/jest/results.xml`生成测试信息。

## 配置ci时自动化测试
使用[circleci](https://circleci.com/)进行ci时自动化测试，即每次push代码后会自动测试，并生成测试文件等。

a. 用github账号登录后，即可添加项目部署，在这里我们为react-ui-wheel这个项目添加自动化测试
![](./images/17.png)

b. 添加circleci的配置文件，在根目录下新建`.circleci`目录，并在该目录下新建`config.yml`，其配置如下：
```
#https://github.com/revolunet/create-react-app-circleci/blob/master/.circleci/config.yml
defaults: &defaults
  docker:
    - image: circleci/node:10.16.3

version: 2
jobs:
  prepare:
    <<: *defaults
    steps:
      - checkout
      - restore_cache:
          keys:
            - v2-dependencies-{{ checksum "package.json" }}
      - run: npm install
      - save_cache:
          paths:
            - node_modules
          key: v2-dependencies-{{ checksum "package.json" }}
      - persist_to_workspace:
          root: .
          paths:
            - node_modules
  build:
    <<: *defaults
    steps:
      - checkout
      - attach_workspace:
          at: .
      - run: npm run build
      - persist_to_workspace:
          root: .
          paths:
            - dist
            - package.json
            - LICENSE
            - README.md
  test:
    <<: *defaults
    steps:
      - checkout
      - attach_workspace:
          at: .
      - run: npm run ci
      - store_test_results:
          path: test-results

workflows:
  version: 2
  build_accept_deploy:
    jobs:
      - prepare
      - build:
          requires:
            - test
      - test:
          requires:
            - prepare
      - publish:
          requires:
            - build
          filters:
            tags:
              only: /^v[0-9]+(\.[0-9]+)*/
            branches:
              ignore: /.*/
```
c. 这样我们每次ci代码就会执行自动化测试:
![](./images/18.png)