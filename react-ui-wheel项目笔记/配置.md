é¡¹ç›®åˆå§‹åŒ–å¯ä»¥å‚è€ƒï¼ˆä»0å¼€å§‹é…ç½®webpackï¼‰ï¼Œè¿™é‡Œä»æ”¯æŒtsxæ–‡ä»¶å¼€å§‹ï¼š
### 1. æ”¯æŒ`.tsx`åç¼€çš„æ–‡ä»¶
```
npm i awesome-typescript-loader --save-dev
npm i typescript --save-dev

// webpack.config.js

const p = require('path')
module.exports = {
    entry: {
        index: './lib/index.tsx'
    },
    output:{
        path:p.resolve(__dirname,'dist')
    },
    mode:'development',
    module: {
        rules: [
            {
                test: /\.tsx?$/,
                use: {
                    loader: "awesome-typescript-loader"
                }
            }
        ]
    }
};
```
æ­¤æ—¶ç›®å½•ç»“æ„ï¼š

![1](./images/1.png)

è¿è¡Œ`npx webpack`å¯åœ¨distç›®å½•ä¸‹ç”Ÿæˆæ‰“åŒ…åçš„æ–‡ä»¶

![2](./images/2.png)

### 2. é…ç½®`webpack-dev-server`è‡ªåŠ¨æ‰“åŒ…
```
npm i webpack-dev-server --save-dev
```
è¿è¡Œ`npx webpack-dev-server`è®¿é—®ä¸‹é¢çš„é“¾æ¥å³å¯è·å–æ‰“åŒ…åçš„js

http://localhost:8080/index.js

### 3. é…ç½®htmlæ’ä»¶
æ²¡ç”¨ html-webpack-pluginæ’ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªjsæ–‡ä»¶ï¼Œéœ€è¦ç»è¿‡webpackæ‰“åŒ…ä¹‹åï¼Œæ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œå¹¶åœ¨htmlæ–‡ä»¶ä¸­ç”¨scriptæ ‡ç­¾å¼•ç”¨æˆ‘ä»¬ä¹‹å‰ç»è¿‡webpackæ‰“åŒ…å¥½çš„jsæ–‡ä»¶ã€‚
ç”¨äº†è¿™ä¸ªæ’ä»¶ä¹‹åï¼Œæ’ä»¶ä¼šè‡ªåŠ¨ç”Ÿæˆhtmlæ–‡ä»¶å¹¶å°†æ‰“åŒ…å¥½çš„jsæ’å…¥æ–‡ä»¶ã€‚
**å®‰è£…ä¾èµ–**
```
npm i html-webpack-plugin --save-dev
```
**é…ç½®webpack**
```
const p = require('path')
const HtmlWebPackPlugin = require("html-webpack-plugin");
module.exports = {
    entry: {
        index: './lib/index.tsx'
    },
    output:{
        path:p.resolve(__dirname,'dist')
    },
    mode:'development',
    module: {
        rules: [
            {
                test: /\.tsx?$/,
                use: {
                    loader: "awesome-typescript-loader"
                }
            }
        ]
    },
    plugins:[
        new HtmlWebPackPlugin({
            template: './index.html'
        })
    ]
};
```
æ­¤æ—¶æ‰§è¡Œ`npx webpack`ä¼šåœ¨`webpack`é…ç½®ä¸‹çš„`output`ç›®å½•ä¸‹ç”Ÿæˆ`index.html`ï¼Œå¹¶è‡ªåŠ¨æ’å…¥æ„å»ºå¥½çš„jsä»£ç 

![3](./images/3.png)

### 4. æ‰“åŒ…å‘½ä»¤å†™åˆ°`package.json`æ–‡ä»¶
```
// package.json

"scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "build": "webpack --mode production",
    "dev": "webpack --mode development",
    "start": "webpack-dev-server --mode development --open"
  }
```
### 5. å¼•å…¥react
**å®‰è£…ä¾èµ–**
```
npm i react react-dom

// å› ä¸ºæ˜¯åœ¨å†™tsä»£ç ï¼Œæ‰€ä»¥è¿˜éœ€å®‰è£…å¯¹åº”çš„å£°æ˜æ–‡ä»¶

npm i @types/react @types/react-dom -D 
```
### 6. å†™reactç»„ä»¶
```
+++  /lib/button.tsx
ä¿®æ”¹  /lib/index.tsx
é…ç½® webpack.config.js
é…ç½® tsconfig.jsonæ–‡ä»¶
```
**a. å¢åŠ button.tsx**
```
+++  /lib/button.tsx

import React from 'react';
function Button(){
    return (
        <button>click me</button>
    )
}
export default Button
```
æ³¨æ„button.tsxæ–‡ä»¶éœ€è¦å¼•å…¥reactï¼Œè¿™æ˜¯å› ä¸ºä¸Šè¿°jsxè¯­æ³•å®é™…ä¸Šæ˜¯ä¸‹é¢è°ƒç”¨çš„è¯­æ³•ç³–, æ•…è€Œéœ€è¦å¼•å…¥reactã€‚
![4](./images/4.png)
**b. ä¿®æ”¹index.tsx**
```
ä¿®æ”¹  /lib/index.tsx
import React from 'react';
import ReactDOM from 'react-dom';
import Button from './button'

ReactDOM.render(
    <Button />,
    document.getElementById('root')
)
```
**c. é…ç½® webpack.config.js**
ä¸Šé¢ä»£ç `import Button from './button'`æ—¶ï¼Œä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼Œ
![5](./images/5.png)
è¿™æ˜¯å› ä¸ºwebpackæ²¡æœ‰æ‰¾åˆ°'./button'æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨`webpack.config.js`å¢åŠ å¦‚ä¸‹é…ç½®ï¼Œå‘Šè¯‰webpackåœ¨é‡åˆ°`import Button from './button'`è¿™æ ·çš„å¯¼å…¥è¯­å¥æ—¶ï¼Œä¼šå…ˆå¯»æ‰¾`./button.ts`æ–‡ä»¶ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±å»å¯»æ‰¾`./button.tsx`,ä¾æ¬¡å¾€åï¼Œå¦‚æœéƒ½æ²¡æœ‰æ‰¾åˆ°å°±ä¼šæŠ¥é”™ã€‚
```
resolve:{
    extensions : ['.ts','.tsx','.js','.jsx']
},
```
**d. é…ç½® tsconfig.json**
åœ¨å¼•å…¥`'react','react-dom'`æ—¶æŠ¥å¦‚ä¸‹é”™è¯¯,
![6](./images/6.png)
åªéœ€åœ¨`tsconfig.json`æ–‡ä»¶çš„`compilerOptions`å±æ€§é‡ŒåŠ ä¸Š, å…·ä½“ä¸ºä»€ä¹ˆï¼Œæš‚æ—¶ç•™ä¸ªå‘ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“å•Šã€‚
```
"compilerOptions": {
    "allowSyntheticDefaultImports": true
}
```
![7](./images/7.png)
æ­¤æ—¶æ–‡ä»¶ç›®å½•æ ‘ï¼š
![8](./images/8.png)

### 7. è§£å†³productionæ¨¡å¼ä¸‹æ‰“åŒ…æ–‡ä»¶å¤ªå¤§çš„é—®é¢˜
å½“é…ç½®`webpack.config.js`çš„`mode : production`æ—¶ï¼Œå†æ‰§è¡Œ`webpack-dev-server`æ—¶ï¼Œæ§åˆ¶å°ä¼šæŠ¥å¦‚ä¸‹warningï¼š
![9](./images/9.png)

è¿™æ˜¯å› ä¸ºæ‰“åŒ…åçš„æ–‡ä»¶åŒ…æ‹¬äº†react,react-domç­‰ä¾èµ–åº“ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æ‰“åŒ…åçš„æ–‡ä»¶å¾ˆå¤§ï¼Œè¶…å‡ºäº†webpackå»ºè®®çš„å¤§å°ã€‚æˆ‘ä»¬å¯ä»¥é…ç½®webpack.config.jsæ¥ä½¿å¾—æ‰“åŒ…æ—¶å¿½ç•¥å®ƒä»¬ï¼š
```
// webpack.config.js
externals: {
        react: {
            commonjs: 'react',
            commonjs2: 'react',
            amd: 'react',
            root: 'React'
        },
        'react-dom': {
            commonjs: 'react-dom',
            commonjs2: 'react-dom',
            amd: 'react-dom',
            root: 'ReactDOM'
        }
    }
```
externalsç”¨æ¥å‘Šè¯‰åœ¨webpackè¦æ„å»ºçš„ä»£ç ä¸­ä½¿ç”¨äº†å“ªäº›ä¸ç”¨è¢«æ‰“åŒ…çš„æ¨¡å—ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº›æ¨¡å—æ˜¯å¤–éƒ¨ç¯å¢ƒæä¾›çš„ï¼Œæ‰“åŒ…æ—¶å¯ä»¥å¿½ç•¥ä»–ä»¬ã€‚
### 8. æ·»åŠ webpackä¸¤ç§æ¨¡å¼çš„é…ç½®æ–‡ä»¶
```
+++ webpack.config.dev.js
+++ webpack.config.prod.js
ä¿®æ”¹ webpack.config.js
ä¿®æ”¹ package.json
```
**a. åŸæœ‰çš„webpack.config.jså­˜æ”¾å…±æœ‰çš„é…ç½®**
```
const p = require('path')
module.exports = {
    entry: {
        index: './lib/index.tsx'
    },
    output: {
        path: p.resolve(__dirname, 'dist')
    },
    resolve: {
        extensions: ['.ts', '.tsx', '.js', '.jsx']
    },
    module: {
        rules: [
            {
                test: /\.tsx?$/,
                use: {
                    loader: "awesome-typescript-loader"
                }
            }
        ]
    },
};
```
**b. æ–°å¢webpack.config.dev.jså­˜æ”¾å¼€å‘æ¨¡å¼ä¸‹çš„é…ç½®**
```
const base = require('./webpack.config')
const HtmlWebPackPlugin = require("html-webpack-plugin");
module.exports = Object.assign({}, base, {
    mode: 'development',
    plugins: [
        new HtmlWebPackPlugin({
            template: './index.html'
            //ä¼šä½¿ç”¨æ ¹ç›®å½•ä¸‹çš„index.htmlä½œä¸ºæ¨¡æ¿
        })
    ],
});
```
**c. æ–°å¢webpack.config.prod.jså­˜æ”¾ç”Ÿäº§æ¨¡å¼ä¸‹çš„é…ç½®**
```
const base = require('./webpack.config')
module.exports = Object.assign({}, base, {
    mode: 'production',
    externals: {
        react: {
            commonjs: 'react',
            commonjs2: 'react',
            amd: 'react',
            root: 'React'
        },
        'react-dom': {
            commonjs: 'react-dom',
            commonjs2: 'react-dom',
            amd: 'react-dom',
            root: 'ReactDOM'
        }
    }
});
```
**d. ä¿®æ”¹package.jsonæ–‡ä»¶**
å¯ä»¥é€šè¿‡ webpack --config file æ¥æŒ‡å®šéœ€è¦ç”¨åˆ°çš„é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ webpack.config.jsï¼Œè¦æ˜¯æ‰¾ä¸åˆ°åˆ™ä½¿ç”¨å†…ç½®çš„ webpack é…ç½®ã€‚
```
"scripts": {
    "build": "webpack --config webpack.config.prod.js",
    "start": "webpack-dev-server --config webpack.config.dev.js"
  }
```
### 8. ä¿®æ”¹tsç¼–è¯‘æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„
é»˜è®¤ä¸‹tsçš„ç¼–è¯‘æ–‡ä»¶è¾“å‡ºè·¯å¾„å’ŒåŸtsæ–‡ä»¶ç›¸åŒï¼Œå¯ä»¥åœ¨tsconfig.jsonæ–‡ä»¶ä¸­æ·»åŠ â€œoutDirâ€: "dist"æ¥æ”¹å˜è¾“å‡ºè·¯å¾„åˆ°distç›®å½•ã€‚æˆ–è€…åœ¨package.jsonæ–‡ä»¶ä¸­ä¿®æ”¹ `"tsc": "tsc --outDir dist"` ã€‚
```
// tsconfig.json
{
    "compilerOptions": {
        "outDir": "dist"
    },
}
```
å¦å¤–ï¼Œå¦‚æœä½ çš„åŒ…æœ‰ä¸€ä¸ªindex.jsæ–‡ä»¶ï¼Œä½ è¿˜éœ€è¦åœ¨package.jsonæ–‡ä»¶ä¸­æŒ‡æ˜ä¸»å£°æ˜æ–‡ä»¶ã€‚å°†typeså±æ€§è®¾ç½®ä¸ºæŒ‡å‘æ‰“åŒ…çš„å£°æ˜æ–‡ä»¶ã€‚
```
// package.json
  "main": "dist/index.jx",
  "types":"dist/index.d.ts",
```
æ­¤æ—¶æ–‡ä»¶å¤¹çš„ç›®å½•ç»“æ„ä¸ºï¼š

![10](./images/10.png)
### 9. é…ç½®jestæµ‹è¯•
**1. å®‰è£…ä¾èµ–**
ç”±äºjeståªä¼šåœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨ï¼Œå› æ­¤åªéœ€è¦åœ¨å¼€å‘ç¯å¢ƒå®‰è£…
```
npm i -D jest babel-jest @babel/preset-env @babel/preset-react react-test-renderer @types/jest ts-jest @types/react-test-renderer 
```
**2. æ·»åŠ babelé…ç½®æ–‡ä»¶**
åœ¨æ ¹ç›®å½•æ·»åŠ babel.config.jsæ–‡ä»¶
```
// babel.config.js
module.exports = {
  presets: ['@babel/preset-env', '@babel/preset-react'],
};
```
**3. æ·»åŠ jesté…ç½®æ–‡ä»¶**
åœ¨æ ¹ç›®å½•æ·»åŠ jest.config.jsæ–‡ä»¶ï¼Œå¹¶åœ¨package.jsoné‡Œé¢é…ç½®jestå‘½ä»¤
```
// jest.config.js (é…ç½®å­—æ®µçš„å«ä¹‰æš‚æ—¶ä¸å¤ªæ¸…æ¥šğŸ˜)
module.exports = {
    verbose: true,
    clearMocks: false,
    collectCoverage: false,
    reporters: ["default"],
    moduleFileExtensions: ["js", "jsx", "ts", "tsx"],
    testMatch: ["<rootDir>/**/__test__/**/*.unit.(js|jsx|ts|tsx)"],
    transform: {
        "^.+unit\\.(js|jsx)$": "babel-jest",
        "^.+\\.(ts|tsx)$": "ts-jest"
    }
}

// package.json
"scripts": {
    "test": "jest --config jest.config.js"
  },
```
**4. æ–°å»ºæµ‹è¯•æ–‡ä»¶**
åœ¨libç›®å½•ä¸‹æ–°å»º__test__ç›®å½•ï¼Œå¹¶åœ¨è¯¥ç›®å½•æ–°å»ºhello_unit.tsxæ–‡ä»¶ï¼Œå¹¶å†™ä¸€ç‚¹ç®€å•çš„æµ‹è¯•ç”¨ä¾‹
```
describe('æˆ‘çš„æµ‹è¯•ç”¨ä¾‹', () => {
    it('1ç­‰äº1', () => {
        expect(1).toEqual(2)
    })
})
```
åœ¨æ§åˆ¶å°è¿è¡Œ`npm run test`ï¼Œåˆ™ä¼šæ˜¾ç¤ºæµ‹è¯•ç”¨ä¾‹å¤±è´¥äº†ã€‚

![](./images/12.png)

æˆ‘ä»¬å°†ä¸Šè¿°ä»£ç æ”¹æˆï¼Œå†è¿è¡Œ`npm run test`ï¼Œ
```
describe('æˆ‘çš„æµ‹è¯•ç”¨ä¾‹', () => {
    it('1ç­‰äº1', () => {
        expect(1).toEqual(1)
    })
})
```
![](./images/14.png)
è‡³æ­¤æˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹å¯ä»¥è·‘èµ·æ¥äº†ğŸ‘ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥å†™ä¸€äº›å’Œæˆ‘ä»¬ä»£ç ç›¸å…³çš„æµ‹è¯•ç”¨ä¾‹äº†ã€‚

**5. æµ‹è¯•æˆ‘ä»¬çš„buttonæŒ‰é’®**

åœ¨lib/__test__ç›®å½•ä¸‹æ–°å»ºbutton_unit.tsxæ–‡ä»¶ï¼Œå¹¶å†™æµ‹è¯•ç”¨ä¾‹
```
import rerender from 'react-test-renderer'
import Button from '../button'
import React from 'react'

describe('button', () => {
    it('è¿™æ˜¯ä¸ªbutton', () => {
        let json = rerender.create(<Button />).toJSON()
        expect(json).toMatchSnapshot()
    })
})
```
æ§åˆ¶å°æ‰§è¡Œ`npm run test`ï¼Œä¼šæ˜¾ç¤ºæˆ‘ä»¬çš„buttonæµ‹è¯•ç”¨ä¾‹å¤±è´¥
![](./images/13.png)
æŠ¥é”™æ˜¾ç¤ºrerenderæ˜¯undefinedï¼Œè¿™æ˜¯å› ä¸º`react-test-renderer`æ²¡æœ‰é»˜è®¤å¯¼å‡ºï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹`tsconfig.json`é…ç½®æ–‡ä»¶
```
{
    "compilerOptions": {
        "module": "esnext",
        "target": "es5",
        "lib": [
            "es6",
            "dom"
        ],
        "jsx": "react",
        "declaration": true,
        "moduleResolution": "node",
        "forceConsistentCasingInFileNames": false,
        "strict": true,
        "experimentalDecorators": true,
        "noErrorTruncation": true,
        "baseUrl": ".",
        // "allowSyntheticDefaultImports": true, æ³¨é‡Šè¿™è¡Œ
        "esModuleInterop": true, // æ·»åŠ è¿™ä¸ªå±æ€§
        "outDir": "dist"
    },
    "include": [
        "lib/**/*",
        "utils/**/*"
    ],
    "exclude": []
}
```
æ­¤æ—¶è¿è¡Œ`npm run test`ï¼Œæˆ‘ä»¬çš„æµ‹è¯•å¯ä»¥æˆåŠŸè¿è¡Œäº†ï¼Œä¸è¿‡ä¸Šé¢å‡½æ•°çš„å«ä¹‰ï¼Œæˆ‘è¿˜ä¸çŸ¥é“ä¸ºå•¥ï¼Œå…ˆç•™ä¸ªå‘ï¼Œä¹‹åå†æ¥å›ç­”ï¼š

![](./images/15.png)
